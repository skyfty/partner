<include file="Public:dialog_header" />
<body data-spy="scroll" data-target=".bs-docs-sidebar" data-twttr-rendered="true" style="background-color: white">
<div class="container">
    <div class="row-fluid">
        <div class="span12">
            <form action="{:U('account/accounttype_add')}" method="post" id="accounttype_form">
                <table class="table table-hover" style="border: none">
                    <tr>
                        <td>类别名:</td>
                        <td>
                            <input type="text" id="name" name="name"/>
                        </td>
                    </tr>
                    <if condition="$_GET['assort'] neq 'cash'">
                        <tr>
                            <td>模型:</td>
                            <td>
                                <select name="module_id" id="module_id" d="add">
                                    <option value="customer">客户</option>
                                    <option value="product">雇员</option>
                                    <option value="inernal">{'league_name'|session}</option>
                                    <option value="staff">员工</option>
                                    <option value="flow">流水</option>
                                    <option value="market">客户服务</option>
                                    <option value="cultivate">培训</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td>类型:</td>
                            <td>
                                <input type="radio" d="add" name="mold" id="mold_-1" value="-1" checked>支出
                                <input type="radio" d="add" name="mold" id="mold_1" value="1">收入
                                <input type="radio" d="add" name="mold" id="mold_-3" value="-3">资金冻结
                                <input type="radio" d="add" name="mold" id="mold_3" value="3" >资金解冻
                            </td>
                        </tr>
                        <tr>
                            <td>相关方:</td>
                            <td>
                                <input type="radio" d="add" name="inflow_model" value="">无
                                <input type="radio" d="add" name="inflow_model" value="customer" >客户
                                <input type="radio" d="add" name="inflow_model" value="product">雇员
                                <input type="radio" d="add" name="inflow_model" value="inernal">公司
                                <input type="radio" d="add" name="inflow_model" value="staff">员工
                                <input type="radio" d="add" name="inflow_model" value="flow">公司流水
                            </td>
                        </tr>
                        <tr>
                            <td>关联模型:</td>
                            <td>
                                <input type="radio" d="add" name="related_model" value="">无
                                <input type="radio" d="add" name="related_model"  value="trade">产品订单
                                <input type="radio" d="add" name="related_model" value="market">客户服务
                                <input type="radio" d="add" name="related_model" value="cultivate">新培训
                            </td>
                        </tr>
                        <tr  id="related_model_type_tr" style="display: none">
                            <td>相关方类别:</td>
                            <td id="related_model_type">
                            </td>
                        </tr>
                        <else/>
                        <tr>
                            <td>相关方:</td>
                            <td>
                                <input type="radio" name="inflow_model" value="customer" >客户
                                <input type="radio" name="inflow_model" value="product">雇员
                                <input type="radio" name="inflow_model" value="staff">员工
                            </td>
                        </tr>
                        <input type="hidden" name="mold" value="-1">
                        <input type="hidden" name="module_id" value="inernal">
                        <tr>
                            <td>关联模型:</td>
                            <td>
                                <input type="radio" name="related_model" value="">无
                                <input type="radio" name="related_model"  value="trade">产品订单
                                <input type="radio" name="related_model" value="market">客户服务
                                <input type="radio" name="related_model" value="cultivate">培训
                            </td>
                        </tr>
                    </if>


                    <tr>
                        <td>{:L('DESCRIPTION')}:</td>
                        <td>
                            <textarea class="span4" d="add" name="description"></textarea>
                        </td>
                    </tr>
                </table>
            </form>
        </div>
    </div>
</div>
</body>

<script>

    function request_related_model_type_add() {
        var mold = $('input:radio[name="mold"][d="add"]:checked').val();
        if (mold == -1 || mold == 1) {
            $("#inflow_model_edit_tr").show();
            var inflow_model = $('input:radio[name="inflow_model"][d="edit"]:checked').val();

        }else {
            $("#def_inflow_model").attr("checked",'checked');
            $("#inflow_model_edit_tr").hide();
            var inflow_model = $('#module_id').val();
        }

        var related_model = $('input:radio[name="related_model"][d="add"]:checked').val();
        $.ajax({
            'type':'get',
            'dataType':'json',
            'url':'{:U("account/getclausetype")}',
            'data':{
                'rm': related_model,
                'im': inflow_model,
                'mo': mold
            },
            'success':function(data){
                if(data.status == 1){
                    if (data.data) {
                        var opt = "<select name='inflow_model_type_id' d='add'><option value=''>无</option>";
                        $.each(data.data, function(k, v){
                            opt += "<option value='"+ v.type_id+"'>" + v.name + "</option>";
                        });
                        opt += "</select>";
                        $("#related_model_type_tr").show();
                        $("#related_model_type").html(opt);
                    } else {
                        $("#related_model_type").html("");
                        $("#related_model_type_tr").hide();
                    }
                } else {
                    ("#related_model_type").html("");
                    $("#related_model_type_tr").hide();
                }
            }
        });
        $("#related_model_type").html("");
        $("#related_model_type_tr").hide();
    }

    $('input:radio[d="add"]').click(function(){
        request_related_model_type_add();
    });

    $("#module_id").change(function(){
        var module = $(this).val();
        switch (module) {
            case "customer": {
                $("#mold_3").removeAttr("disabled");
                $("#mold_-3").removeAttr("disabled");
                break;
            }
            case "product": {
                $("#mold_3").removeAttr("disabled");
                $("#mold_-3").removeAttr("disabled");
                break;
            }
            case "staff": {
                $("#mold_3").removeAttr("disabled");
                $("#mold_-3").removeAttr("disabled");
                break;
            }
            case "market":
            case "cultivate":
            case "flow":
            case "inernal": {
                $("#mold_3").attr("disabled", "disabled");
                $("#mold_-3").attr("disabled", "disabled");
                break;
            }
        }
    });
</script>