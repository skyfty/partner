
<form class="form-horizontal" action="{:U('setting/fieldadd')}" method="post" name="form1" id="form1">
    <div id="dialog-add-field" class="modal fade" role="dialog"  aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
                </button>
                <h4 class="modal-title" id="myModalLabel">
                    添加字段
                </h4>
            </div>

            <div class="modal-body">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">
                    关闭
                </button>
                <button type="submit" class="btn btn-primary">
                    保存
                </button>
            </div>
        </div>
        <script>
            $("#dialog-add-field").on("hidden", function() {
                $(this).removeData("modal");
            });
        </script>
    </div>
</form>

<form action="{:U('setting/fieldedit')}" method="post" id="edit_form">
    <div id="dialog-edit-field" class="modal fade" role="dialog"  aria-hidden="true">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
                </button>
                <h4 class="modal-title">
                    修改字段
                </h4>
            </div>
            <div class="modal-body">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">
                    关闭
                </button>
                <button type="submit" class="btn btn-primary">
                    提交更改
                </button>
            </div>
        </div>
        <script>
            $("#dialog-edit-field").on("hidden", function() {
                $(this).removeData("modal");
            });
        </script>
    </div>
</form>

<script type="text/javascript">
    $("table tbody").sortable({
        connectWith: "table tbody",
        stop: function( event, ui ) {
            $.each($(".list"), function(i, item){
                var item_tr = $(item).parent().parent();
                while(true) {
                    if (item_tr.attr('group_id') != undefined) {
                        break;
                    }
                    item_tr = item_tr.prev();
                }
                var field_group_id = item_tr.attr('group_id');
                $(item).attr('group_id', field_group_id);
            });
        }
    });

    function checkForm(){
        return confirm('确实要提交更改吗？');
    }

    $(function(){
        $("#check_all").click(function(){
            $("input[class='list']:enabled").prop('checked', $(this).prop("checked"));
            $("input[class='check_group']:enabled").prop('checked', $(this).prop("checked"));
        });

        $(".check_group").click(function(){
            var group_id = $(this).attr('group_id');
            $("input[class='list'][group_id='"+group_id+"']:enabled").prop('checked', $(this).prop("checked"));
        });

        $("#fieldsgroup").click(function(){
            window.location.assign('{:U("setting/fieldsgroup","model=$model&assort=$assort")}');
        });

        $(".delete").click(function(){
            var id = $(this).attr('rel');
            if(confirm('{:L('DELETE_THE_SELECTED_FIELDS_OPERATION_CANNOT_BE_RESTORED')}')){
                window.location.assign('{:U("setting/fielddelete","field_id")}'+id);
            }
        });
        $(".indexShow").click(function(){
            var id = $(this).attr('rel');
            window.location.assign('{:U("setting/indexShow","field_id")}'+id);
        });

        $(".homeShow").click(function(){
            var id = $(this).attr('rel');
            window.location.assign('{:U("setting/homeShow","field_id")}'+id);
        });

        $("#sort_btn").click(
            function() {
                position = [];
                $.each($(".list"), function(i, item){
                    var field_group_id= $(item).attr('group_id');
                    position.push({field_id:item.value,field_group_id: field_group_id});
                });

                $.get('{:U("setting/fieldsort")}',{postion:position}, function(data){
                    if (data.status == 1) {
                        $('.alert.alert-success').remove();
                        $(".page-header").after('<div class="alert alert-success"><button type="button" class="close" data-dismiss="alert">×</button>' + data.info + '</div>');
                    } else {
                        $('.alert.alert-error').remove();
                        $(".page-header").after('<div class="alert alert-error"><button type="button" class="close" data-dismiss="alert">×</button>' + data.info + '</div>');
                    }
                }, 'json');
            }
        );

        $(".level_urge_position_ratio").click(function(){
            var dialog = art.dialog({
                id: 'N3690',
                title: "促单费系数",
                lock:true,
                ok: function () {
                    $("#urge_position_ratio_dialog_form").submit();
                },
                cancel:true
            });
            $.ajax({
                url:'{:U("user/urge_position_ratio_dialog")}',
                success: function (data) {
                    dialog.content(data);
                },
                cache: false
            });
        });
    });
</script>