<include file="Public:header" />

<div class="container">
    <!-- Docs nav ================================================== -->
    <div class="page-header">
        <h4><a name="tab">{:L('THE_CUSTOMER_DETAILS')}</a></h4>
    </div>
    <div class="row">
        <div class="span12">
            <include file="Public:alert" />
            <div class="tabbable">
                <include file="Customer:navtab" />
            </div>
            <div class="tab-content">
                <table class="table">
                    <thead>
                    <tr>
                        <td colspan="4">
                            <p style="font-size: 14px;">
                            </p>
                        </td>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td colspan="6">
                            <include file="Customer:basicinfo" />
                        </td>
                    </tr>
                    </tbody>
                </table>
                <!--  -->

                <table class="table" id="market-data-table">
                    <thead>
                    <tr>
                        <volist name="field_array" id="vo">
                            <th>
                                {$vo.name}
                            </th>
                        </volist>
                        <th style="width:40px;text-align: center">{:L('OPERATION')}</th>
                    </tr>
                    </thead>
                    <tbody>
                    <volist name="customer.market" id="vo">
                        <tr>
                            <include file="Market:model_list_row" />
                            <td style="text-align: center">
                                <a href="{:U('market/view', 'id='.$vo['market_id'])}" title="查看详情"  target="_blank" >
                                    <i class="icon-th-large"></i>
                                </a>
                            </td>
                        </tr>
                    </volist>
                    </tbody>
                </table>
                <style>
                    th, td { white-space: nowrap; }
                    div.dataTables_wrapper {
                        width: 1155px;
                        margin: 0 auto;
                    }
                </style>
                <script type="text/javascript">
                    $(document).ready(function() {
                        $('#market-data-table').dataTable( {
                            "order": [[ 0, "desc" ]],
                            "scrollX": true,
                            'language': def_dataTable_lang_opt
                        } );
                    });
                </script>
            </div>
        </div>
    </div>
</div>

<script>

    $(".market_service_product").each(function() {
        $(this).qtip({
            content: {
                text: function(event, api) {
                    var market_id = api.elements.target.attr("market_id");
                    $.ajax({
                        url: "{:U('market/getmarketproduct')}&market_id=" + market_id
                    })
                    .then(function(content) {
                        var html = "";
                        $.each(content, function(b){
                            html += "[" + this.idcode + "] "+ this.name + "<br/>";
                        });
                        api.set('content.text', html);
                    }, function(xhr, status, error) {
                        // Upon failure... set the tooltip content to error
                        api.set('content.text', status + ': ' + error);
                    });
                    return 'Loading...'; // Set some initial text
                }
            },
            position: {
                target: 'mouse', // Track the mouse as the positioning target
                adjust: { x: 5, y: 5 } // Offset it slightly from under the mouse
            },

            style: 'qtip-bootstrap'
        });
    });
</script>

<include file="Public:footer" />