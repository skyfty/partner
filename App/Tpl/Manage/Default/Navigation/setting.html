<include file="Public:header" />
<style>
table tbody tr{cursor:move;}
</style>
	<div class="container">
		<div class="page-header">
			<h4>{:L('SYSTEM_SETTINGS')}</h4>
		</div>
		<include file="Public:alert" />
        <include file="Setting:settingnav" />

        <form action="{:U('navigation/delete')}" method="post">
		<div class="row">
			<div class="span12">
				<div class="nav pull-left">
					{:league_select_html("bylea", $_GET['bylea'])}&nbsp;&nbsp;
					<script>
						function def_short_search_select( val, label) {
							var lea = $("#bylea").val();
							window.location="{:U('navigation/setting','bylea=')}"+lea;
						}
						$(function() {
							$("#bylea").change(def_short_search_select);
						});
					</script>
					<button type="submit" class="btn"><i class="icon-remove"></i>&nbsp;{:L('DELETE')}</button>&nbsp;
					<a id="sort_btn" class="btn"><i class=" icon-file"></i>&nbsp;{:L('SAVE_THE_LOCATION')}</a>

				</div>
				<div class="pull-right">
					<a class="btn btn-primary" id="add_navigation"><i class="icon-plus"></i>&nbsp; {:L('ADD_NAVIGATION_MENU')}</a>

				</div>
			</div>
		</div>
		<div class="row">
			<div class="span6" id="postion_top">
				<h4>{:L('NAVIGATION_LOCATION_AT_THE_TOP')}</h4>
				<table class="table table-hover">
					<thead>
						<tr>
						   <th><input class="check_all" type="checkbox" /></th>
						   <th width="25%">{:L('MENU')}</th>
						   <th>{:L('LINK')}</th>
							<th>状态</th>
						</tr>
					</thead>
					<tbody>
						<empty name="postion.top">
						<tr><td colspan="4">{:L('THIS_POSITION_IS_NOT_TO_ADD_THE_MENU')}</td></tr>
						<else />
						<volist name = "postion.top" id="vo">
							<tr><td><input type="checkbox" class="list" name="list[]" value="{$vo.id}"/> &nbsp; 
								</td>
								<td>{$vo.title}</td>
								<td><a href="{$vo.url}" target="_blank"><if condition="strlen($vo['url']) gt 25">{$vo.url|substr=0,25}...<else/>{$vo.url}</if></a></td>
								<td>								<a class="edit" href="javascript:void(0);" rel="{$vo.id}">{:L('EDITING')}</a>  &nbsp;
									<a href="{:U('navigation/changestate','id='.$vo['id'].'&bylea='.$_GET['bylea'])}"><if condition="$vo['state'] eq 1">隐藏<else/>显示</if></a></td>

							</tr>
						</volist>	
						</empty>
					</tbody>
				</table>
			</div>

			<div class="span6" id="postion_user">
				<h4>{:L('NAVIGATION_LOCATION_PERSONAL_CENTER')}</h4>
				<table class="table table-hover">
					<thead>
						<tr>
						   <th><input class="check_all" type="checkbox" /></th>
						   <th width="25%">{:L('MENU')}</th>
						   <th>{:L('LINK')}</th>
							<th>状态</th>
						</tr>
					</thead>
					<tbody>
						<empty name="postion.user">
							<tr><td colspan="4">{:L('THIS_POSITION_IS_NOT_TO_ADD_THE_MENU')}</td></tr>
						<else />
						<volist name = "postion.user" id="vo">
							<tr><td><input type="checkbox" class="list" name="list[]" value="{$vo.id}"/> &nbsp;
								</td>
								<td>{$vo.title}</td>
								<td><a href="{$vo.url}" target="_blank"><if condition="strlen($vo['url']) gt 25">{$vo.url|substr=0,25}...<else/>{$vo.url}</if></a></td>
								<td>								<a class="edit" href="javascript:void(0);" rel="{$vo.id}">{:L('EDITING')}</a>  &nbsp;
									<a href="{:U('navigation/changestate','id='.$vo['id'].'&bylea='.$_GET['bylea'])}"><if condition="$vo['state'] eq 1">隐藏<else/>显示</if></a></td>

							</tr>
						</volist>
						</empty>
					</tbody>
				</table>
			</div>
			<div class="span12"><span style="color: rgb(243, 40, 12);">{:L('PROMPT')}</span></div>
		</div>
	</div>
<script type="text/javascript">
	$(function(){
		$(".check_all").click(function(){
			$(this).parents("table").find("input[class='list']").prop('checked', $(this).prop("checked"));
		});

		$("#add_navigation").click(function(){
            var dialog = art.dialog({
                id: 'N3690',
                title: "新建 ",
                lock:true,
                ok: function () {
                    $("#nav_add_form").submit();
                },
                cancel:true
            });
            $.ajax({
                url:'{:U("navigation/add","bylea=".$_GET["bylea"])}',
                success: function (data) {
                    dialog.content(data);
                },
                cache: false
            });


		});
		$("table tbody").sortable({connectWith: "table tbody"});
		$(".edit").click(
			function(){
                tid = $(this).attr('rel');

                var dialog = art.dialog({
                    id: 'N3690',
                    title: "编辑",
                    lock:true,
                    ok: function () {
                        $("#nav_edit_form").submit();
                    },
                    cancel:true
                });
                $.ajax({
                    url:'{:U("navigation/edit","bylea=".$_GET["bylea"]."&id=")}' + tid,
                    success: function (data) {
                        dialog.content(data);
                    },
                    cache: false
                });

			}
		);
		$("#sort_btn").click(
			function() {
				postion_top = [];
				$.each($("#postion_top .list"), function(i, item){postion_top.push(item.value)});
				postion_user = [];
				$.each($("#postion_user .list"), function(i, item){postion_user.push(item.value)});
				postion_more = [];
				$.each($("#postion_more .list"), function(i, item){postion_more.push(item.value)});
				$.get('{:U("navigation/sort")}',{postion_top:postion_top.join(','), postion_user:postion_user.join(','), postion_more:postion_more.join(',')}, function(data){
					if (data.status == 1) {
						$(".page-header").after('<div class="alert alert-success"><button type="button" class="close" data-dismiss="alert">×</button>' + data.info + '</div>');
					} else {
						$(".page-header").after('<div class="alert alert-error"><button type="button" class="close" data-dismiss="alert">×</button>' + data.info + '</div>');
					}
				}, 'json');
			}		
		);
	});
	function deleteDepartment(id,name){
		var v = confirm({:L('SURE_TO_DELETE_THE_MENU')});
		if(v == true){
			window.location="{:U('navigation/delete','id=')}"+id + "&bylea={$_GET['bylea']}";
		}
	}

</script>
<include file="Public:footer" />