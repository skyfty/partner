<include file="Public:header" />

<div class="container">
<div class="page-header" style="border:none; font-size:14px; ">
    <ul class="nav nav-tabs">
      <li class="active">
        <a href="{:U('task/index')}">
            <img src="__PUBLIC__/img/renwu.png"/>&nbsp; {:L('TASK')}
        </a>
      </li>
    </ul>
</div>
<include file="Public:alert" />
<p class="view"><b>{:L('VIEW_NAV')}</b>
    <img src=" __PUBLIC__/img/by_owner.png"/> <a href="{:U('task/index')}" <if condition="$Think.get.by eq null">class="active"</if>>{:L('ALL')}</a> |
    <a href="{:U('task/index','by=me')}" <if condition="$Think.get.by eq 'me'">class="active"</if>>{:L('MY_TASK')}</a> |
    <a href="{:U('task/index','by=create')}" <if condition="$Think.get.by eq 'create'">class="active"</if>>{:L('I_ASSIGNED_TASKS')}</a>  &nbsp;  &nbsp;
    <img src=" __PUBLIC__/img/by_status.png"/>
    <a href="{:U('task/index','by=s4')}" <if condition="$Think.get.by eq 's4'">class="active"</if>>未处理</a> |
    <a href="{:U('task/index','by=s1')}" <if condition="$Think.get.by eq 's1'">class="active"</if>>接受</a> |
    <a href="{:U('task/index','by=s2')}" <if condition="$Think.get.by eq 's2'">class="active"</if>>完成</a> |
    <a href="{:U('task/index','by=s3')}" <if condition="$Think.get.by eq 's3'">class="active"</if>>拒绝</a> |
    <a href="{:U('task/index','by=closed')}" <if condition="$Think.get.by eq 'closed'">class="active"</if>>{:L('CLOSED')}</a>  &nbsp;  &nbsp;
    <img src=" __PUBLIC__/img/by_owner.png"/>
    <a href="{:U('task/index','by=sd')}" <if condition="$Think.get.by eq 'sd'">class="active"</if>>一般性任务</a> |
    <a href="{:U('task/index','by=jj')}" <if condition="$Think.get.by eq 'jj'">class="active"</if>>紧急任务</a>  &nbsp;  &nbsp;
    <img src="__PUBLIC__/img/by_time.png"/> <a href="{:U('task/index','by=today')}" <if condition="$Think.get.by eq 'today'">class="active"</if>>{:L('TODAY_DEADLINE')}</a> |
    <a href="{:U('task/index','by=week')}" <if condition="$Think.get.by eq 'week'">class="active"</if>>{:L('THIS_WEEK_DEADLINE')}</a> |
    <a href="{:U('task/index','by=month')}" <if condition="$Think.get.by eq 'month'">class="active"</if>>{:L('THIS_MONTH_DEADLINE')}</a> |
    <a href="{:U('task/index','by=add')}" <if condition="$Think.get.by eq 'add'">class="active"</if>>{:L('RECENTLY_ASSIGN')}</a> |
    <a href="{:U('task/index','by=update')}" <if condition="$Think.get.by eq 'update'">class="active"</if>>{:L('RECENTLY_UPDATE')}</a> &nbsp;  &nbsp;
</p>
<div class="row-fluid">
    <div class="span12">
        <ul class="nav pull-left">
            <li class="pull-left">
                <a id="delete"  class="btn"><i class="icon-remove"></i>&nbsp;{:L('DELETE')}</a>
                &nbsp;
            </li>
            <li class="pull-left">
            <form class="form-inline" id="searchForm" action="" method="get">
                <ul class="nav pull-left">
                <li class="pull-left">&nbsp;
                    <select id="field" style="width:auto" onchange="changeCondition()" name="field">
                        <option class="all" value="all">{:L('ANY_FIELDS')}</option>
                        <option class="word" value="subject">{:L('TASK_SUBJECT')}</option>
                        <option class="role" value="owner_role_id">{:L('EXECUTOR')}</option>
                        <option class="role" value="creator_role_id">{:L('CREATOR_ROLE')}</option>
                        <option class="task_status" value="status">{:L('TASK_STATUS')}</option>
                        <option class="task_priority" value="priority">{:L('PRECEDENCE')}</option>
                        <option class="word" value="description">{:L('DESCRIPTION')}</option>
                        <option class="date" value="due_date">{:L('DEADLINE')}</option>
                        <option class="date" value="create_date">{:L('CREATE_DATE')}</option>
                        <option class="date" value="update_date">{:L('UPDATE_DATE')}</option>
                    </select>&nbsp;&nbsp;
                </li>
                <li id="conditionContent" class="pull-left">
                    <select id="condition" style="width:auto" name="condition" onchange="changeSearch()">
                        <option value="contains">{:L('CONTAINS')}</option>
                        <option value="is">{:L('IS')}</option>
                        <option value="start_with">{:L('START_WITH')}</option>
                        <option value="end_with">{:L('END_WITH')}</option>
                        <option value="is_empty">{:L('IS_EMPTY')}</option>
                    </select>&nbsp;&nbsp;
                </li>
                <li id="searchContent" class="pull-left">
                    <input id="search" type="text" class="input-medium search-query" name="search"/>&nbsp;&nbsp;
                </li>
                <li class="pull-left">
                    <input type="hidden" name="m" value="Task"/>
                    <input type="hidden" name="act" id="act" value="search"/>
                    <if condition="$Think.get.by neq null">
                        <input type="hidden" name="by" value="{$Think.get.by}"/>
                    </if>
                    <input type="submit" id="dosearch" class="btn" value="{:L('SEARCH')}"/>
                </li></ul>
            </form>
            </li>
        </ul>
        <div class="pull-right">
            <a href="{:U('task/add')}" class="btn btn-primary">
                <i class="icon-plus"></i>&nbsp; {:L('CREATE_TASK')}
            </a>&nbsp;
        </div>
    </div>
    <div class="row-fluid">
        <div class="span12">
            <form id="form1" action="" method="post">
                <table class="table table-hover table-striped table_thead_fixed">
                    <empty name="task_list">
                        <tr><td>{:L('EMPTY_TPL_DATA')}</td></tr>
                    <else />
                        <thead>
                            <tr>
                                <th><input type="checkbox" id="control_all" name="control_all"/></th>
                                <th width="20px">&nbsp;</th>
                                <th>{:L('THEME')}</th>
                                <th>{:L('RELATED_INFO')}</th>
                                <th>{:L('EXECUTOR')}</th>
                                <th>{:L('STATUS')}</th>
                                <th>{:L('PRECEDENCE')}</th>
                                <th>创建时间</th>
                                <th>创建者</th>
                                <th>{:L('OPERATING')}</th>
                            </tr>
                        </thead>
                        <tfoot>
                            <tr><td colspan="10">
                                <p>{:L('NOTE')}
                                    <img src="__PUBLIC__/img/task_owner.png"/> {:L('MY_RESPONSIBLE')} &nbsp;
                                    <img src="__PUBLIC__/img/task_creator.png"/>{:L('I_ASSIGNED')} &nbsp;
                                </p>{$page}
                            </td></tr>
                        </tfoot>
                        <tbody>
                            <volist name="task_list" id="vo">
                                <tr <if condition="$vo['leader']"> class="error"<elseif condition="$vo['priority'] eq '紧急任务' "/> class="warning"</if>>
                                    <td>
                                        <input name="task_id[]" class="check_list" type="checkbox" value="{$vo.task_id}"/>
                                    </td>
                                    <td>
                                        <if condition="session('role_id') eq $vo['owner_role_id'] ">
                                            <img src="__PUBLIC__/img/task_owner.png"/>
                                        <elseif condition="session('role_id') eq $vo['creator_role_id'] "/>
                                            <img src="__PUBLIC__/img/task_creator.png"/>
                                        </if>
                                    </td>
                                    <td>
                                        <a href="{:U('task/view','id='.$vo['task_id'])}">{$vo.subject}</a>
                                    </td>
                                    <td>{$vo.module.module_name} {$vo.module.name}</td>
                                    <td>
                                        <volist name="vo['owner']" id="v">
                                            <notempty name="v.user_name">
                                                <a class="role_info" rel="{$v.role_id}" href="javascript:void(0)">{$v.user_name},</a>
                                            </notempty>
                                        </volist>
                                    </td>
                                    <td>{$vo.status}</td>
                                    <td>{$vo.priority}</td>
                                    <td>{$vo.create_date|toDate=###}</td>
                                    <td>
                                        <a class="role_info" rel="{$vo.creator.role_id}" href="javascript:void(0)">{$vo.creator.user_name}</a>
                                    </td>

                                    <td>
                                        <a href="{:U('task/view','id='.$vo['task_id'])}">{:L('VIEW')}</a>&nbsp;
                                        <if condition="$Think.get.by neq 'deleted'">
                                            <a href="{:U('task/edit','id='.$vo['task_id'])}">{:L('EDIT')}</a>
                                        <else />
                                            <a href="{:U('task/revert','id='.$vo['task_id'])}" title="{:L('RESET')}">{:L('RESET')}</a>
                                        </if>
                                        <if condition="$vo['isclose'] eq 0 and $Think.get.by neq 'deleted' and ($vo['creator']['role_id'] eq $_SESSION['role_id'] or $Think.session.admin eq 1 )"><a href="{:U('task/close','id='.$vo['task_id'])}">{:L('CLOSE')} &nbsp;</a><elseif condition="$Think.get.by neq 'deleted' and $vo['isclose'] eq 1 and ($vo['creator']['role_id'] eq $_SESSION['role_id'] or $Think.session.admin eq 1 ) "/><a href="{:U('task/open','id='.$vo['task_id'])}">{:L('OPEN')} &nbsp;</a></if>
                                    </td>
                                </tr>
                            </volist>
                        </tbody>
                    </empty>
                </table>
            </form>
        </div>
    </div>
</div>
</div>
<div class="hide" id="dialog-role-info" title="{:L('DIALOG_USER_INFO')}">loading...</div>
<script type="text/javascript">
$("#dialog-role-info").dialog({
    autoOpen: false,
    modal: true,
	width: 800,
	maxHeight: 400,
	position: ["center",100]
});

function changeContent(){
	var a = $("#select1  option:selected").val();
	window.location.href="{:U('task/index','by=')}"+a;
}

$(function(){
    <if condition="$Think.get.field neq null">
        $("#field option[value='{$Think.get.field}']").prop("selected", true);changeCondition();
        $("#condition option[value='{$Think.get.condition}']").prop("selected", true);changeSearch();
        $("#search").prop('value', '{$Think.get.search}');
    </if>
	$("#control_all").click(function(){
		$("input[class='check_list']").prop('checked', $(this).prop("checked"));
	});
	$('#delete').click(function(){
		if(confirm("{:L('CONFIRM_DELETE')}")){
			$("#form1").attr('action', '{:U("task/delete")}');
			$("#form1").submit();
		}
	});

	$("#dosearch").click(function(){
		var result = checkSearchForm();
		if(result) $("#act").val('search');$("#searchForm").submit();
	});
});
</script>
<include file="Public:footer" />