
<script type="text/javascript">
    $(function(){
        $("#settle_duration").attr("readonly","readonly");
        $("#recess_day").val("{$market['recess_day']}");
        $("#recess_day").change(on_recess_day_change);
        $("#time_adjust").change(on_recess_day_change);
        $("#service_price").change(on_recess_day_change);
        $("#money_adjust").change(calculate_settle_money);
        $("#agency_scale").change(calculate_agency_money);
        $("#agency").change(on_agency_change);
    });

    function calculate_service_duration() {
        var recess_day = $("#recess_day").val();
        if (!recess_day) recess_day = 0;
        recess_day = parseFloat(recess_day);

        var hours = calculate_service_day();
        hours = parseFloat(hours);
        var ssdays = hours % 24;
        if (ssdays < 4 ) ssdays = 0;
        else if ( ssdays < 16) ssdays = 0.5;
        else ssdays = 1;
        var days = parseInt(hours / 24) + ssdays;

        var service_duration = Math.max(days - recess_day, 0);
        $("#service_duration").val(service_duration);

        var time_adjust = $("#time_adjust").val();
        if (!time_adjust) time_adjust = 0;
        time_adjust = parseFloat(time_adjust);

        $("#settle_duration").val(service_duration + time_adjust);
        calculate_settle_money();
    }


    function calculate_settle_money() {
        var service_duration = $("#service_duration").val();
        if (!service_duration) service_duration = 0;
        service_duration = parseFloat(service_duration);

        var service_price = $("#service_price").val();
        if (!service_price) service_price = 0;
        service_price = parseFloat(service_price);

        <if condition="($market['category_id'] == '6') || ($market['category_id'] == '14')">
        var price = Math.round(parseFloat(service_duration * service_price));
        <else/>
        var price = Math.round(parseFloat(service_duration * service_price / 26));
        </if>
        $("#price").val(price);

        var settle_duration = $("#settle_duration").val();
        if (!settle_duration) settle_duration = 0;
        settle_duration = parseFloat(settle_duration);

        var money_adjust = $("#money_adjust").val();
        if (!money_adjust) money_adjust = 0;
        money_adjust = parseFloat(money_adjust);
        <if condition="($market['category_id'] == '6') || ($market['category_id'] == '14')">
        var settle_price = Math.round(parseFloat(service_price * settle_duration + money_adjust));
        <else/>
         var settle_price = Math.round(parseFloat(service_price / 26 * settle_duration + money_adjust));
        </if>
        $("#settle_price").val(settle_price);

        calculate_agency_money();
    }

</script>
<include file="product_datapick"/>
